/* astjs 1.0.4 | (c) 2016 - Max Seiden <140dbs@gmail.com> | MIT Licensed */
(function(){var t=function(t,r){function e(){this.constructor=t}for(var o in r)n.call(r,o)&&(t[o]=r[o]);return e.prototype=r.prototype,t.prototype=new e,t.__super__=r.prototype,t},n={}.hasOwnProperty;!function(){var n,r,e,o,u,i,s,l,c,f,a,p;p="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||this,f=p._||"undefined"!=typeof require&&null!==require&&require("underscore"),e=function(){function t(t){this.strategies=t,f.map(this.strategies,function(t){return function(n){return n.planner=t}}(this))}return t.prototype.plan=function(t){var n,r;return n=function(n){return n.execute(t)},r=f.map(this.strategies,n),f.flatten(r)},t.prototype.planLater=function(t){return this.plan(t)[0]},t}(),o=function(){function t(){}return t.prototype.execute=function(){return[]},t}(),s=function(){function t(t){this.batches=null!=t?t:[]}return t.prototype.execute=function(t){var n;return n=function(t,n){return n.execute(t)},f.foldl(this.batches,n,t,{})},t}(),i=function(){function t(t,n){this.rules=t,this.iterations=n}return t.prototype.execute=function(t){var n,r,e,o,u,i;for(o=t,i=null,n=e=0,u=this.iterations;u>e;n=e+=1){if(r=function(t,n){return n.execute(t)},i=f.foldl(this.rules,r,o,{}),i.sameResult(o))return i;o=i}return i},t}(),u=function(){function t(){}return t.prototype.execute=function(t){return t},t}(),l=function(){function t(n,r,e){this.ctor=n,this.args=null!=r?r:[],this.children=null!=e?e:[],this.nodeid=t.nextNodeID()}return t.prototype.nodeName=function(){return this.ctor.name},t.prototype.toString=function(t){var n,r;return null==t&&(t=!1),n=f.map(this.args,function(t){return t.toString()}).join(","),r=t?"#"+this.nodeid:"",this.nodeName()+"["+n+"]"+r},t.prototype.print=function(t,n){var r,e;return null==t&&(t=!1),null==n&&(n=0),e=f.times(n,function(){return" "}).join(""),r=f.map(this.children,function(r){return r.print(t,1+n)}),"\n"+e+this.toString(t)+r.join("")},t.prototype.sameResult=function(t){var n;return f.isEqual(this.ctor,t.ctor)&&f.isEqual(this.args,t.args)?(n=f.zip(this.children,t.children),f.all(n,function(t){var n,r;return n=t[0],r=t[1],n.sameResult(r)})):!1},t.prototype.copy=function(t,n){var r;return null==t&&(t=this.args),null==n&&(n=this.children),r=new this.ctor,r.ctor=this.ctor,r.args=t,r.children=n,r},t.prototype.walkUp=function(t){return this.walk(t,!1)},t.prototype.walkDown=function(t){return this.walk(t,!0)},t.prototype.walk=function(t,n){null==n&&(n=!0),n?(t(this),f.each(this.children,function(r){return r.walk(t,n)})):(f.each(this.children,function(r){return r.walk(t,n)}),t(this))},t.prototype.find=function(t){return t(this)?this:f.isEmpty(this.children)?null:f.find(this.children,function(n){return null!=n.find(t)})},t.prototype.map=function(t){var n;return n=[],this.walk(function(r){return n.push(t(r))}),n},t.prototype.flatMap=function(t){return f.flatten(this.map(t))},t.prototype.filter=function(t){return this.flatMap(function(n){return t(n)?[n]:[]})},t.prototype.transformUp=function(t){return this.transform(t,!1)},t.prototype.transformDown=function(t){return this.transform(t,!0)},t.prototype.transform=function(n,r){return null==r&&(r=!0),t.transform(this,n,r)},t.transform=function(n,r,e){var o,u;return e?(o=r(n),u=o.sameResult(n)?n:o,t.transformChildren(u,r,e)):(o=t.transformChildren(n,r,e),u=o.sameResult(n)?n:o,r(u))},t.transformChildren=function(t,n,r){var e,o,u,i,s,l;for(l=[],i=t.children,o=0,u=i.length;u>o;o++)e=i[o],s=e.transform(n,r),l.push(s);return t.copy(t.args,l)},t.nextNodeID=function(){var t;return t=0,function(){return++t}}(),t}(),r=function(n){function r(t,n){r.__super__.constructor.call(this,t,n,[])}return t(r,n),r}(l),c=function(n){function r(t,n,e){r.__super__.constructor.call(this,t,n,[e])}return t(r,n),r}(l),n=function(n){function r(t,n,e,o){r.__super__.constructor.call(this,t,n,[e,o])}return t(r,n),r}(l),a="undefined"==typeof module||null===module||module.nodeType?p.astjs={}:module.exports={},a.TreeNode=l,a.LeafNode=r,a.UnaryNode=c,a.BinaryNode=n,a.Rule=u,a.RuleBatch=i,a.RuleExecutor=s,a.Planner=e,a.PlannerStrategy=o}()}).call(this);