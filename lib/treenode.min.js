/* astjs 1.0.6 | (c) 2016 - Max Seiden <140dbs@gmail.com> | MIT Licensed */
(function(){var t=function(t,r){function e(){this.constructor=t}for(var o in r)n.call(r,o)&&(t[o]=r[o]);return e.prototype=r.prototype,t.prototype=new e,t.__super__=r.prototype,t},n={}.hasOwnProperty;!function(){var n,r,e,o,i,u,l,s,c,a,f,p;p="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||this,a=p._||"undefined"!=typeof require&&null!==require&&require("underscore"),e=function(){function t(t){this.strategies=t,a.map(this.strategies,function(t){return function(n){return n.planner=t}}(this)),this.planned={}}return t.prototype.plan=function(t){var n,r;return n=function(n){return n.execute(t)},r=a.map(this.strategies,n),a.filter(a.flatten(r),function(t){return null!=t})},t.prototype.planLater=function(t){var n;if(n=this.planned[t.nodeid],null==n){if(null==(n=this.plan(t)[0]))throw new Error("unable to plan tree: "+t.print());t.nondeterministic!==!0&&(this.planned[t.nodeid]=n)}return n},t}(),o=function(){function t(){}return t.prototype.execute=function(){return[]},t}(),l=function(){function t(t){this.batches=null!=t?t:[]}return t.prototype.execute=function(t){var n;return n=function(t,n){return n.execute(t)},a.foldl(this.batches,n,t,{})},t}(),u=function(){function t(t,n){this.rules=t,this.iterations=n}return t.prototype.execute=function(t){var n,r,e,o,i,u;for(o=t,u=null,n=e=0,i=this.iterations;i>e;n=e+=1){if(r=function(t,n){return n.execute(t)},u=a.foldl(this.rules,r,o,{}),u.sameResult(o))return o;o=u}return u},t}(),i=function(){function t(){}return t.prototype.execute=function(t){return t},t}(),s=function(){function t(n,r,e){this.ctor=n,this.args=null!=r?r:[],this.children=null!=e?e:[],this.nodeid=t.nextNodeID()}return t.prototype.nodeName=function(){return this.ctor.name},t.prototype.toString=function(t){var n,r;return null==t&&(t=!1),n=a.map(this.args,function(t){return t.toString()}).join(","),r=t?"#"+this.nodeid:"",this.nodeName()+"["+n+"]"+r},t.prototype.print=function(t,n){var r,e;return null==t&&(t=!1),null==n&&(n=0),e=a.times(n,function(){return" "}).join(""),r=a.map(this.children,function(r){return r.print(t,1+n)}),"\n"+e+this.toString(t)+r.join("")},t.prototype.sameResult=function(t){var n;return a.isEqual(this.ctor,t.ctor)&&a.isEqual(this.args,t.args)?(n=a.zip(this.children,t.children),a.all(n,function(t){var n,r;return n=t[0],r=t[1],n.sameResult(r)})):!1},t.prototype.copy=function(t,n){var r;return null==t&&(t=this.args),null==n&&(n=this.children),r=new this.ctor,r.ctor=this.ctor,r.args=t,r.children=n,r},t.prototype.walkUp=function(t){return this.walk(t,!1)},t.prototype.walkDown=function(t){return this.walk(t,!0)},t.prototype.walk=function(t,n){null==n&&(n=!0),n?(t(this),a.each(this.children,function(r){return r.walk(t,n)})):(a.each(this.children,function(r){return r.walk(t,n)}),t(this))},t.prototype.find=function(t){return t(this)?this:a.isEmpty(this.children)?null:a.find(this.children,function(n){return null!=n.find(t)})},t.prototype.map=function(t){var n;return n=[],this.walk(function(r){return n.push(t(r))}),n},t.prototype.flatMap=function(t){return a.flatten(this.map(t))},t.prototype.filter=function(t){return this.flatMap(function(n){return t(n)?[n]:[]})},t.prototype.transformUp=function(t){return this.transform(t,!1)},t.prototype.transformDown=function(t){return this.transform(t,!0)},t.prototype.transform=function(n,r){return null==r&&(r=!0),t.transform(this,n,r)},t.transform=function(n,r,e){var o,i;return e?(o=r(n),i=o.sameResult(n)?n:o,t.transformChildren(i,r,e)):(o=t.transformChildren(n,r,e),i=o.sameResult(n)?n:o,r(i))},t.transformChildren=function(t,n,r){var e,o,i,u,l,s;for(s=[],u=t.children,o=0,i=u.length;i>o;o++)e=u[o],l=e.transform(n,r),s.push(l);return t.copy(t.args,s)},t.nextNodeID=function(){var t;return t=0,function(){return++t}}(),t}(),r=function(n){function r(t,n){r.__super__.constructor.call(this,t,n,[])}return t(r,n),r}(s),c=function(n){function r(t,n,e){r.__super__.constructor.call(this,t,n,[e])}return t(r,n),r}(s),n=function(n){function r(t,n,e,o){r.__super__.constructor.call(this,t,n,[e,o])}return t(r,n),r}(s),f="undefined"==typeof module||null===module||module.nodeType?p.astjs={}:module.exports={},f.TreeNode=s,f.LeafNode=r,f.UnaryNode=c,f.BinaryNode=n,f.Rule=i,f.RuleBatch=u,f.RuleExecutor=l,f.Planner=e,f.PlannerStrategy=o}()}).call(this);